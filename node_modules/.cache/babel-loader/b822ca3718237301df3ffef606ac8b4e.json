{"ast":null,"code":"var _jsxFileName = \"/home/lucas/Projects/Todo App/Client/src/pages/Dashboard.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport Input from \"../components/input/Input\";\nimport Tasklist from \"../components/tasklist/Tasklist\";\nimport axios from \"axios\";\nimport { Link, Routes, Route, useNavigate } from \"react-router-dom\";\nimport { faArrowRightFromBracket } from \"@fortawesome/free-solid-svg-icons\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Dashboard() {\n  _s();\n\n  const isMounted = useRef(false);\n  const [tasks, setTasks] = useState([]);\n  const navigate = useNavigate();\n  const [user, setUser] = useState(\"\"); // Coloca token JWT no header das requests\n\n  axios.interceptors.request.use(config => {\n    config.headers.authorization = `Bearer ${sessionStorage.getItem(\"jwt\")}`;\n    return config;\n  }, error => {\n    return Promise.reject(error);\n  }); // API call: Get tasks\n\n  useEffect(() => {\n    if (sessionStorage.getItem(\"jwt\") === null) {\n      logout();\n    } else {\n      getTasksCall();\n      getUser();\n    }\n  }, []); // GET\n\n  function getTasksCall() {\n    axios.get(\"https://pereira277todoapi.herokuapp.com/dashboard/\").then(response => {\n      console.log(response.data);\n      setTasks(response.data);\n    }).catch(async function (error) {\n      console.log(\"Executing refresh token GETTASKS\");\n      await refreshTokens(getTasksCall);\n    });\n  } // Get current logged user\n\n\n  function getUser() {\n    axios.get(\"https://pereira277todoapi.herokuapp.com/dashboard/user\").then(response => {\n      console.log(`User ${response.data} logged in`);\n      setUser(response.data);\n    }).catch(async function (error) {\n      console.log(\"Executing refresh token GETUSER\");\n      await refreshTokens(getUser);\n    });\n  } // refresh Token\n\n\n  async function refreshTokens(func) {\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    return axios.post(\"https://pereira277todoapi.herokuapp.com/user/token\", {\n      token: refreshToken\n    }).then(response => {\n      sessionStorage.setItem(\"jwt\", response.data.accessToken);\n      sessionStorage.setItem(\"refreshjwt\", response.data.refreshToken);\n    }).then(() => func()).catch(error => {\n      console.log(error.response.status);\n      logout();\n    });\n  }\n\n  function logout() {\n    // AXIOS CALL TO REMOVE REFRESH TOKEN\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    axios.post(\"https://pereira277todoapi.herokuapp.com/user/deletetoken\", {\n      token: refreshToken\n    });\n    sessionStorage.removeItem(\"jwt\");\n    sessionStorage.removeItem(\"refreshjwt\");\n    navigate(\"/\");\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"title\",\n        children: \"TO DO\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faArrowRightFromBracket,\n        className: \"exit-icon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-container\",\n      children: [/*#__PURE__*/_jsxDEV(Input, {\n        getTasksCall: getTasksCall,\n        logout: logout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Tasklist, {\n        setTasks: setTasks,\n        tasks: tasks,\n        getTasksCall: getTasksCall,\n        logout: logout,\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Dashboard, \"CKGDRaJRq7bct+ZlgjtrklCqfs4=\", false, function () {\n  return [useNavigate];\n});\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Input","Tasklist","axios","Link","Routes","Route","useNavigate","faArrowRightFromBracket","Dashboard","isMounted","tasks","setTasks","navigate","user","setUser","interceptors","request","use","config","headers","authorization","sessionStorage","getItem","error","Promise","reject","logout","getTasksCall","getUser","get","then","response","console","log","data","catch","refreshTokens","func","refreshToken","post","token","setItem","accessToken","status","removeItem"],"sources":["/home/lucas/Projects/Todo App/Client/src/pages/Dashboard.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport Input from \"../components/input/Input\";\nimport Tasklist from \"../components/tasklist/Tasklist\";\nimport axios from \"axios\";\nimport { Link, Routes, Route, useNavigate } from \"react-router-dom\";\nimport { faArrowRightFromBracket} from \"@fortawesome/free-solid-svg-icons\";\n\n\nfunction Dashboard() {\n  const isMounted = useRef(false);\n  const [tasks, setTasks] = useState([]);\n  const navigate = useNavigate();\n  const [user, setUser] = useState(\"\");\n\n  // Coloca token JWT no header das requests\n  axios.interceptors.request.use(\n    (config) => {\n      config.headers.authorization = `Bearer ${sessionStorage.getItem(\"jwt\")}`;\n      return config;\n    },\n    (error) => {\n      return Promise.reject(error);\n    }\n  );\n\n  // API call: Get tasks\n  useEffect(() => {\n    if (sessionStorage.getItem(\"jwt\") === null) {\n      logout();\n    } else {\n      getTasksCall();\n      getUser();\n    }\n  }, []);\n\n  // GET\n  function getTasksCall() {\n    axios\n      .get(\"https://pereira277todoapi.herokuapp.com/dashboard/\")\n      .then((response) => {\n        console.log(response.data);\n        setTasks(response.data);\n      })\n      .catch(async function (error) {\n        console.log(\"Executing refresh token GETTASKS\");\n        await refreshTokens(getTasksCall);\n      });\n  }\n\n  // Get current logged user\n  function getUser() {\n    axios\n      .get(\"https://pereira277todoapi.herokuapp.com/dashboard/user\")\n      .then((response) => {\n        console.log(`User ${response.data} logged in`);\n        setUser(response.data);\n      })\n      .catch(async function (error) {\n        console.log(\"Executing refresh token GETUSER\");\n        await refreshTokens(getUser);\n      });\n  }\n\n  // refresh Token\n  async function refreshTokens(func) {\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    return axios\n      .post(\"https://pereira277todoapi.herokuapp.com/user/token\", {\n        token: refreshToken,\n      })\n      .then((response) => {\n        sessionStorage.setItem(\"jwt\", response.data.accessToken);\n        sessionStorage.setItem(\"refreshjwt\", response.data.refreshToken);\n      })\n      .then(() => func())\n      .catch((error) => {\n        console.log(error.response.status);\n        logout();\n      });\n  }\n\n  function logout() {\n    // AXIOS CALL TO REMOVE REFRESH TOKEN\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    axios.post(\"https://pereira277todoapi.herokuapp.com/user/deletetoken\", {\n      token: refreshToken,\n    });\n    sessionStorage.removeItem(\"jwt\");\n    sessionStorage.removeItem(\"refreshjwt\");\n    navigate(\"/\");\n  }\n\n  return (\n    <div className=\"App\">\n      <div>\n        <h1 className=\"title\">TO DO</h1>\n        <FontAwesomeIcon icon={faArrowRightFromBracket} className=\"exit-icon\" />\n\n\n      </div>\n      <div className=\"main-container\">\n        <Input getTasksCall={getTasksCall} logout={logout} />\n        <Tasklist\n          setTasks={setTasks}\n          tasks={tasks}\n          getTasksCall={getTasksCall}\n          logout={logout}\n          user={user}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default Dashboard;\n"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,OAAOC,KAAP,MAAkB,2BAAlB;AACA,OAAOC,QAAP,MAAqB,iCAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,IAAT,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,WAA9B,QAAiD,kBAAjD;AACA,SAASC,uBAAT,QAAuC,mCAAvC;;;AAGA,SAASC,SAAT,GAAqB;EAAA;;EACnB,MAAMC,SAAS,GAAGV,MAAM,CAAC,KAAD,CAAxB;EACA,MAAM,CAACW,KAAD,EAAQC,QAAR,IAAoBd,QAAQ,CAAC,EAAD,CAAlC;EACA,MAAMe,QAAQ,GAAGN,WAAW,EAA5B;EACA,MAAM,CAACO,IAAD,EAAOC,OAAP,IAAkBjB,QAAQ,CAAC,EAAD,CAAhC,CAJmB,CAMnB;;EACAK,KAAK,CAACa,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACGC,MAAD,IAAY;IACVA,MAAM,CAACC,OAAP,CAAeC,aAAf,GAAgC,UAASC,cAAc,CAACC,OAAf,CAAuB,KAAvB,CAA8B,EAAvE;IACA,OAAOJ,MAAP;EACD,CAJH,EAKGK,KAAD,IAAW;IACT,OAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD,CAPH,EAPmB,CAiBnB;;EACAzB,SAAS,CAAC,MAAM;IACd,IAAIuB,cAAc,CAACC,OAAf,CAAuB,KAAvB,MAAkC,IAAtC,EAA4C;MAC1CI,MAAM;IACP,CAFD,MAEO;MACLC,YAAY;MACZC,OAAO;IACR;EACF,CAPQ,EAON,EAPM,CAAT,CAlBmB,CA2BnB;;EACA,SAASD,YAAT,GAAwB;IACtBzB,KAAK,CACF2B,GADH,CACO,oDADP,EAEGC,IAFH,CAESC,QAAD,IAAc;MAClBC,OAAO,CAACC,GAAR,CAAYF,QAAQ,CAACG,IAArB;MACAvB,QAAQ,CAACoB,QAAQ,CAACG,IAAV,CAAR;IACD,CALH,EAMGC,KANH,CAMS,gBAAgBZ,KAAhB,EAAuB;MAC5BS,OAAO,CAACC,GAAR,CAAY,kCAAZ;MACA,MAAMG,aAAa,CAACT,YAAD,CAAnB;IACD,CATH;EAUD,CAvCkB,CAyCnB;;;EACA,SAASC,OAAT,GAAmB;IACjB1B,KAAK,CACF2B,GADH,CACO,wDADP,EAEGC,IAFH,CAESC,QAAD,IAAc;MAClBC,OAAO,CAACC,GAAR,CAAa,QAAOF,QAAQ,CAACG,IAAK,YAAlC;MACApB,OAAO,CAACiB,QAAQ,CAACG,IAAV,CAAP;IACD,CALH,EAMGC,KANH,CAMS,gBAAgBZ,KAAhB,EAAuB;MAC5BS,OAAO,CAACC,GAAR,CAAY,iCAAZ;MACA,MAAMG,aAAa,CAACR,OAAD,CAAnB;IACD,CATH;EAUD,CArDkB,CAuDnB;;;EACA,eAAeQ,aAAf,CAA6BC,IAA7B,EAAmC;IACjC,IAAIC,YAAY,GAAGjB,cAAc,CAACC,OAAf,CAAuB,YAAvB,CAAnB;IACA,OAAOpB,KAAK,CACTqC,IADI,CACC,oDADD,EACuD;MAC1DC,KAAK,EAAEF;IADmD,CADvD,EAIJR,IAJI,CAIEC,QAAD,IAAc;MAClBV,cAAc,CAACoB,OAAf,CAAuB,KAAvB,EAA8BV,QAAQ,CAACG,IAAT,CAAcQ,WAA5C;MACArB,cAAc,CAACoB,OAAf,CAAuB,YAAvB,EAAqCV,QAAQ,CAACG,IAAT,CAAcI,YAAnD;IACD,CAPI,EAQJR,IARI,CAQC,MAAMO,IAAI,EARX,EASJF,KATI,CASGZ,KAAD,IAAW;MAChBS,OAAO,CAACC,GAAR,CAAYV,KAAK,CAACQ,QAAN,CAAeY,MAA3B;MACAjB,MAAM;IACP,CAZI,CAAP;EAaD;;EAED,SAASA,MAAT,GAAkB;IAChB;IACA,IAAIY,YAAY,GAAGjB,cAAc,CAACC,OAAf,CAAuB,YAAvB,CAAnB;IACApB,KAAK,CAACqC,IAAN,CAAW,0DAAX,EAAuE;MACrEC,KAAK,EAAEF;IAD8D,CAAvE;IAGAjB,cAAc,CAACuB,UAAf,CAA0B,KAA1B;IACAvB,cAAc,CAACuB,UAAf,CAA0B,YAA1B;IACAhC,QAAQ,CAAC,GAAD,CAAR;EACD;;EAED,oBACE;IAAK,SAAS,EAAC,KAAf;IAAA,wBACE;MAAA,wBACE;QAAI,SAAS,EAAC,OAAd;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QADF,eAEE,QAAC,eAAD;QAAiB,IAAI,EAAEL,uBAAvB;QAAgD,SAAS,EAAC;MAA1D;QAAA;QAAA;QAAA;MAAA,QAFF;IAAA;MAAA;MAAA;MAAA;IAAA,QADF,eAOE;MAAK,SAAS,EAAC,gBAAf;MAAA,wBACE,QAAC,KAAD;QAAO,YAAY,EAAEoB,YAArB;QAAmC,MAAM,EAAED;MAA3C;QAAA;QAAA;QAAA;MAAA,QADF,eAEE,QAAC,QAAD;QACE,QAAQ,EAAEf,QADZ;QAEE,KAAK,EAAED,KAFT;QAGE,YAAY,EAAEiB,YAHhB;QAIE,MAAM,EAAED,MAJV;QAKE,IAAI,EAAEb;MALR;QAAA;QAAA;QAAA;MAAA,QAFF;IAAA;MAAA;MAAA;MAAA;IAAA,QAPF;EAAA;IAAA;IAAA;IAAA;EAAA,QADF;AAoBD;;GAxGQL,S;UAGUF,W;;;KAHVE,S;AA0GT,eAAeA,SAAf"},"metadata":{},"sourceType":"module"}