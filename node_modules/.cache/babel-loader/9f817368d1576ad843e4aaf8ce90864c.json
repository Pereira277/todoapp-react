{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lucas\\\\OneDrive\\\\Documents\\\\todoapp-react\\\\src\\\\pages\\\\Dashboard.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport Input from \"../components/input/Input\";\nimport Tasklist from \"../components/tasklist/Tasklist\";\nimport axios from \"axios\";\nimport { Link, Routes, Route, useNavigate } from \"react-router-dom\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faArrowRightFromBracket } from \"@fortawesome/free-solid-svg-icons\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Dashboard() {\n  _s();\n\n  const isMounted = useRef(false);\n  const [tasks, setTasks] = useState([]);\n  const navigate = useNavigate();\n  const [user, setUser] = useState(\"\"); // Coloca token JWT no header das requests\n\n  axios.interceptors.request.use(config => {\n    config.headers.authorization = `Bearer ${sessionStorage.getItem(\"jwt\")}`;\n    return config;\n  }, error => {\n    return Promise.reject(error);\n  }); // API call: Get tasks\n\n  useEffect(() => {\n    if (sessionStorage.getItem(\"jwt\") === null) {\n      logout();\n    } else {\n      getTasksCall();\n      getUser();\n    }\n  }, []); // GET\n\n  function getTasksCall() {\n    axios.get(\"https://pereira277todoapi.herokuapp.com/dashboard/\").then(response => {\n      console.log(response.data);\n      setTasks(response.data);\n    }).catch(async function (error) {\n      console.log(\"Executing refresh token GETTASKS\");\n      await refreshTokens(getTasksCall);\n    });\n  } // Get current logged user\n\n\n  function getUser() {\n    axios.get(\"https://pereira277todoapi.herokuapp.com/dashboard/user\").then(response => {\n      console.log(`User ${response.data} logged in`);\n      setUser(response.data);\n    }).catch(async function (error) {\n      console.log(\"Executing refresh token GETUSER\");\n      await refreshTokens(getUser);\n    });\n  } // refresh Token\n\n\n  async function refreshTokens(func) {\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    return axios.post(\"https://pereira277todoapi.herokuapp.com/user/token\", {\n      token: refreshToken\n    }).then(response => {\n      sessionStorage.setItem(\"jwt\", response.data.accessToken);\n      sessionStorage.setItem(\"refreshjwt\", response.data.refreshToken);\n    }).then(() => func()).catch(error => {\n      console.log(error.response.status);\n      logout();\n    });\n  }\n\n  function logout() {\n    // AXIOS CALL TO REMOVE REFRESH TOKEN\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\n    axios.post(\"https://pereira277todoapi.herokuapp.com/user/deletetoken\", {\n      token: refreshToken\n    });\n    sessionStorage.removeItem(\"jwt\");\n    sessionStorage.removeItem(\"refreshjwt\");\n    navigate(\"/\");\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"title\",\n        children: \"TO DO\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faArrowRightFromBracket,\n        className: \"exit-icon\",\n        onClick: () => logout()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-container\",\n      children: [/*#__PURE__*/_jsxDEV(Input, {\n        getTasksCall: getTasksCall,\n        logout: logout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Tasklist, {\n        setTasks: setTasks,\n        tasks: tasks,\n        getTasksCall: getTasksCall,\n        logout: logout,\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Dashboard, \"CKGDRaJRq7bct+ZlgjtrklCqfs4=\", false, function () {\n  return [useNavigate];\n});\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Input","Tasklist","axios","Link","Routes","Route","useNavigate","FontAwesomeIcon","faArrowRightFromBracket","Dashboard","isMounted","tasks","setTasks","navigate","user","setUser","interceptors","request","use","config","headers","authorization","sessionStorage","getItem","error","Promise","reject","logout","getTasksCall","getUser","get","then","response","console","log","data","catch","refreshTokens","func","refreshToken","post","token","setItem","accessToken","status","removeItem"],"sources":["C:/Users/lucas/OneDrive/Documents/todoapp-react/src/pages/Dashboard.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport Input from \"../components/input/Input\";\r\nimport Tasklist from \"../components/tasklist/Tasklist\";\r\nimport axios from \"axios\";\r\nimport { Link, Routes, Route, useNavigate } from \"react-router-dom\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faArrowRightFromBracket} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\n\r\nfunction Dashboard() {\r\n  const isMounted = useRef(false);\r\n  const [tasks, setTasks] = useState([]);\r\n  const navigate = useNavigate();\r\n  const [user, setUser] = useState(\"\");\r\n\r\n  // Coloca token JWT no header das requests\r\n  axios.interceptors.request.use(\r\n    (config) => {\r\n      config.headers.authorization = `Bearer ${sessionStorage.getItem(\"jwt\")}`;\r\n      return config;\r\n    },\r\n    (error) => {\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\n  // API call: Get tasks\r\n  useEffect(() => {\r\n    if (sessionStorage.getItem(\"jwt\") === null) {\r\n      logout();\r\n    } else {\r\n      getTasksCall();\r\n      getUser();\r\n    }\r\n  }, []);\r\n\r\n  // GET\r\n  function getTasksCall() {\r\n    axios\r\n      .get(\"https://pereira277todoapi.herokuapp.com/dashboard/\")\r\n      .then((response) => {\r\n        console.log(response.data);\r\n        setTasks(response.data);\r\n      })\r\n      .catch(async function (error) {\r\n        console.log(\"Executing refresh token GETTASKS\");\r\n        await refreshTokens(getTasksCall);\r\n      });\r\n  }\r\n\r\n  // Get current logged user\r\n  function getUser() {\r\n    axios\r\n      .get(\"https://pereira277todoapi.herokuapp.com/dashboard/user\")\r\n      .then((response) => {\r\n        console.log(`User ${response.data} logged in`);\r\n        setUser(response.data);\r\n      })\r\n      .catch(async function (error) {\r\n        console.log(\"Executing refresh token GETUSER\");\r\n        await refreshTokens(getUser);\r\n      });\r\n  }\r\n\r\n  // refresh Token\r\n  async function refreshTokens(func) {\r\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\r\n    return axios\r\n      .post(\"https://pereira277todoapi.herokuapp.com/user/token\", {\r\n        token: refreshToken,\r\n      })\r\n      .then((response) => {\r\n        sessionStorage.setItem(\"jwt\", response.data.accessToken);\r\n        sessionStorage.setItem(\"refreshjwt\", response.data.refreshToken);\r\n      })\r\n      .then(() => func())\r\n      .catch((error) => {\r\n        console.log(error.response.status);\r\n        logout();\r\n      });\r\n  }\r\n\r\n  function logout() {\r\n    // AXIOS CALL TO REMOVE REFRESH TOKEN\r\n    let refreshToken = sessionStorage.getItem(\"refreshjwt\");\r\n    axios.post(\"https://pereira277todoapi.herokuapp.com/user/deletetoken\", {\r\n      token: refreshToken,\r\n    });\r\n    sessionStorage.removeItem(\"jwt\");\r\n    sessionStorage.removeItem(\"refreshjwt\");\r\n    navigate(\"/\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <div className=\"header\">\r\n        <h1 className=\"title\">TO DO</h1>\r\n        <FontAwesomeIcon icon={faArrowRightFromBracket} className=\"exit-icon\" onClick={() => logout()}/>\r\n      </div>\r\n      <div className=\"main-container\">\r\n        <Input getTasksCall={getTasksCall} logout={logout} />\r\n        <Tasklist\r\n          setTasks={setTasks}\r\n          tasks={tasks}\r\n          getTasksCall={getTasksCall}\r\n          logout={logout}\r\n          user={user}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Dashboard;\r\n"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,OAAOC,KAAP,MAAkB,2BAAlB;AACA,OAAOC,QAAP,MAAqB,iCAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,IAAT,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,WAA9B,QAAiD,kBAAjD;AACA,SAASC,eAAT,QAAgC,gCAAhC;AACA,SAASC,uBAAT,QAAuC,mCAAvC;;;AAGA,SAASC,SAAT,GAAqB;EAAA;;EACnB,MAAMC,SAAS,GAAGX,MAAM,CAAC,KAAD,CAAxB;EACA,MAAM,CAACY,KAAD,EAAQC,QAAR,IAAoBf,QAAQ,CAAC,EAAD,CAAlC;EACA,MAAMgB,QAAQ,GAAGP,WAAW,EAA5B;EACA,MAAM,CAACQ,IAAD,EAAOC,OAAP,IAAkBlB,QAAQ,CAAC,EAAD,CAAhC,CAJmB,CAMnB;;EACAK,KAAK,CAACc,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACGC,MAAD,IAAY;IACVA,MAAM,CAACC,OAAP,CAAeC,aAAf,GAAgC,UAASC,cAAc,CAACC,OAAf,CAAuB,KAAvB,CAA8B,EAAvE;IACA,OAAOJ,MAAP;EACD,CAJH,EAKGK,KAAD,IAAW;IACT,OAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD,CAPH,EAPmB,CAiBnB;;EACA1B,SAAS,CAAC,MAAM;IACd,IAAIwB,cAAc,CAACC,OAAf,CAAuB,KAAvB,MAAkC,IAAtC,EAA4C;MAC1CI,MAAM;IACP,CAFD,MAEO;MACLC,YAAY;MACZC,OAAO;IACR;EACF,CAPQ,EAON,EAPM,CAAT,CAlBmB,CA2BnB;;EACA,SAASD,YAAT,GAAwB;IACtB1B,KAAK,CACF4B,GADH,CACO,oDADP,EAEGC,IAFH,CAESC,QAAD,IAAc;MAClBC,OAAO,CAACC,GAAR,CAAYF,QAAQ,CAACG,IAArB;MACAvB,QAAQ,CAACoB,QAAQ,CAACG,IAAV,CAAR;IACD,CALH,EAMGC,KANH,CAMS,gBAAgBZ,KAAhB,EAAuB;MAC5BS,OAAO,CAACC,GAAR,CAAY,kCAAZ;MACA,MAAMG,aAAa,CAACT,YAAD,CAAnB;IACD,CATH;EAUD,CAvCkB,CAyCnB;;;EACA,SAASC,OAAT,GAAmB;IACjB3B,KAAK,CACF4B,GADH,CACO,wDADP,EAEGC,IAFH,CAESC,QAAD,IAAc;MAClBC,OAAO,CAACC,GAAR,CAAa,QAAOF,QAAQ,CAACG,IAAK,YAAlC;MACApB,OAAO,CAACiB,QAAQ,CAACG,IAAV,CAAP;IACD,CALH,EAMGC,KANH,CAMS,gBAAgBZ,KAAhB,EAAuB;MAC5BS,OAAO,CAACC,GAAR,CAAY,iCAAZ;MACA,MAAMG,aAAa,CAACR,OAAD,CAAnB;IACD,CATH;EAUD,CArDkB,CAuDnB;;;EACA,eAAeQ,aAAf,CAA6BC,IAA7B,EAAmC;IACjC,IAAIC,YAAY,GAAGjB,cAAc,CAACC,OAAf,CAAuB,YAAvB,CAAnB;IACA,OAAOrB,KAAK,CACTsC,IADI,CACC,oDADD,EACuD;MAC1DC,KAAK,EAAEF;IADmD,CADvD,EAIJR,IAJI,CAIEC,QAAD,IAAc;MAClBV,cAAc,CAACoB,OAAf,CAAuB,KAAvB,EAA8BV,QAAQ,CAACG,IAAT,CAAcQ,WAA5C;MACArB,cAAc,CAACoB,OAAf,CAAuB,YAAvB,EAAqCV,QAAQ,CAACG,IAAT,CAAcI,YAAnD;IACD,CAPI,EAQJR,IARI,CAQC,MAAMO,IAAI,EARX,EASJF,KATI,CASGZ,KAAD,IAAW;MAChBS,OAAO,CAACC,GAAR,CAAYV,KAAK,CAACQ,QAAN,CAAeY,MAA3B;MACAjB,MAAM;IACP,CAZI,CAAP;EAaD;;EAED,SAASA,MAAT,GAAkB;IAChB;IACA,IAAIY,YAAY,GAAGjB,cAAc,CAACC,OAAf,CAAuB,YAAvB,CAAnB;IACArB,KAAK,CAACsC,IAAN,CAAW,0DAAX,EAAuE;MACrEC,KAAK,EAAEF;IAD8D,CAAvE;IAGAjB,cAAc,CAACuB,UAAf,CAA0B,KAA1B;IACAvB,cAAc,CAACuB,UAAf,CAA0B,YAA1B;IACAhC,QAAQ,CAAC,GAAD,CAAR;EACD;;EAED,oBACE;IAAK,SAAS,EAAC,KAAf;IAAA,wBACE;MAAK,SAAS,EAAC,QAAf;MAAA,wBACE;QAAI,SAAS,EAAC,OAAd;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QADF,eAEE,QAAC,eAAD;QAAiB,IAAI,EAAEL,uBAAvB;QAAgD,SAAS,EAAC,WAA1D;QAAsE,OAAO,EAAE,MAAMmB,MAAM;MAA3F;QAAA;QAAA;QAAA;MAAA,QAFF;IAAA;MAAA;MAAA;MAAA;IAAA,QADF,eAKE;MAAK,SAAS,EAAC,gBAAf;MAAA,wBACE,QAAC,KAAD;QAAO,YAAY,EAAEC,YAArB;QAAmC,MAAM,EAAED;MAA3C;QAAA;QAAA;QAAA;MAAA,QADF,eAEE,QAAC,QAAD;QACE,QAAQ,EAAEf,QADZ;QAEE,KAAK,EAAED,KAFT;QAGE,YAAY,EAAEiB,YAHhB;QAIE,MAAM,EAAED,MAJV;QAKE,IAAI,EAAEb;MALR;QAAA;QAAA;QAAA;MAAA,QAFF;IAAA;MAAA;MAAA;MAAA;IAAA,QALF;EAAA;IAAA;IAAA;IAAA;EAAA,QADF;AAkBD;;GAtGQL,S;UAGUH,W;;;KAHVG,S;AAwGT,eAAeA,SAAf"},"metadata":{},"sourceType":"module"}